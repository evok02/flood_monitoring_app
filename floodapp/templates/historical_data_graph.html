<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <title>Historical Data</title>
    <link rel="stylesheet" href="https://unpkg.com/@trevoreyre/autocomplete-js/dist/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.css' %}" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" />
    <link href="{% static 'css/font-awesome.min.css' %}" rel="stylesheet" />
    <link href="{% static 'css/style.css' %}" rel="stylesheet" />
    <link href="{% static 'css/responsive.css' %}" rel="stylesheet" />
    <div class="container-fluid">
      <nav class="navbar navbar-expand-lg custom_nav-container ">
        <a class="navbar-brand" href="{% url 'home' %}">{% block title %}Flood Monitoring System{% endblock title %}
          
        </a>
      

        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class=""> </span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav">
              <li class="nav-item {% if request.resolver_match.url_name == 'home' %}active{% endif %}">
                <a class="nav-link" href="{% url 'home' %}">Home</a>
              </li>
              <li class="nav-item {% if request.resolver_match.url_name == 'about' %}active{% endif %}">
                <a class="nav-link" href="{% url 'about' %}">About</a>
              </li>
              <li class="nav-item {% if request.resolver_match.url_name == 'map' %}active{% endif %}">
                <a class="nav-link" href="{% url 'map' %}">View Map</a>
              </li>
              {% if user.is_authenticated %}
                <li class="nav-item {% if request.resolver_match.url_name == 'logout' %}active{% endif %}">
                  <a class="nav-link" href="{% url 'logout' %}">Logout</a>
                </li>
              {% else %}
                <li class="nav-item {% if request.resolver_match.url_name == 'login' %}active{% endif %}">
                  <a class="nav-link" href="{% url 'login' %}">Login</a>
                </li>
              {% endif %}
            </ul>
            <div class="quote_btn-container">
              <a href="{% url 'report-emergency' %}" class="quote_btn {% if request.resolver_match.url_name == 'report-emergency' %}quote_btn_active{% endif %}">
                Write Report
              </a>
            </div>
          </div>
        
      </nav>
    </div>
</head>
<body>
    <h1>Historical Data</h1>
    <h5>Location:</h5>
    <form method="post" id="location-form">
        {% csrf_token %}
        <div id="search-fields">
            <div class="autocomplete-container">
                <div id="autocomplete-1" class="autocomplete">
                    <input class="autocomplete-input" name="location" />
                    <ul class="autocomplete-result-list"></ul>
                </div>
            </div>
        </div>
        <button type="button" id="add-location-btn" class="btn btn-secondary">Add Location</button>
        {% for field in form %}
            {% if field.name != 'location' %}
                <div class="form-group">
                    {{ field.label_tag }} {{ field }}
                </div>
            {% endif %}
        {% endfor %}
        <div class="quote_btn-container">
            <button type="submit" class="quote_btn">Generate</button>
        </div>
    </form>

    {% if line_plot %}
        <div class="center-container">
            <h2>Line Plot</h2>
            <img src="data:image/png;base64,{{ line_plot }}" alt="Line Plot">
        </div>
    {% endif %}

    {% if box_plots %}
    <div class="center-container">
        <h2>Box Plots</h2>
        {% for box_plot in box_plots %}
            <div>
                <img src="data:image/png;base64,{{ box_plot }}" alt="Box Plot">
            </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if bar_plot %}
    <div class="center-container">
        <h2>Bar Plot</h2>
        <img src="data:image/png;base64,{{ bar_plot }}" alt="Bar Plot">
    </div>
    {% endif %}

    <script src="https://unpkg.com/@trevoreyre/autocomplete-js"></script>
    <script>
        let counter = 1;

        new Autocomplete(`#autocomplete-${counter}`, {
            search: input => {
                const url = '/map/search/?location=' + input;
                return new Promise(resolve => {
                    fetch(url)
                        .then(response => response.json())
                        .then(data => resolve(data.data));
                });
            }
        });

        document.getElementById('add-location-btn').addEventListener('click', () => {
            counter++;

            const newAutocomplete = document.createElement('div');
            newAutocomplete.className = 'autocomplete-container';
            newAutocomplete.innerHTML = `
                <div id="autocomplete-${counter}" class="autocomplete">
                    <input class="autocomplete-input" name="location-${counter}" />
                    <ul class="autocomplete-result-list"></ul>
                </div>
            `;

            document.getElementById('search-fields').appendChild(newAutocomplete);

            new Autocomplete(`#autocomplete-${counter}`, {
                search: input => {
                    const url = '/map/search/?location=' + input;
                    return new Promise(resolve => {
                        fetch(url)
                            .then(response => response.json())
                            .then(data => resolve(data.data));
                    });
                }
            });
        });
    </script>
</body>
</html>
